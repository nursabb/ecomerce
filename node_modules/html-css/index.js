var fs = require('fs');

Array.prototype.unique = function(arr) {
    var newArr = [];
    arr.forEach(function (it, n) {
        if (newArr.indexOf(it) == -1) {
            newArr.push(it);
        }
    });

    return newArr;
};

        fs.readFile(process.argv[2], function (err, info) {
            var tags, x = [[], []];
            var idsExp = /(?:id=)"([^"]*)"/i;
            var classExp = /(?:class=)"([^"]*)"/i;
            var outName;

            tags = info.toString().split('\n');

            tags.forEach(function(it, n){
                if (idsExp.test(it)) {
                    x[0][x[0].length] = ("#" + idsExp.exec(it)[1].replace(/\s/g, '.') + " \{\n\n\}\n");
                    x[0] = x[0].unique(x[0]);
                }
                if (classExp.test(it)) {
                    x[1][x[1].length] = ("." + classExp.exec(it)[1].replace(/\s/g, '.') + " \{\n\n\}\n");
                    x[1] = x[1].unique(x[1]);
                }
            });

            outName = process.argv[3] ? process.argv[3]:process.argv[2].split('.')[0] + '.css';

            fs.writeFile(outName, x.join('\n').replace(/,/g, '\n'), 'utf8', function(err){
                if (err) {
                    console.log(err)
                }else{
                    console.log('Done!');
                }
            });
        });